/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","],r="d",i="n",s="j",u="b";function f(e,l){let{type:t}=l,n=`r[${e}]`,f=t===r?`new Date(${n})`:t===s?`JSON.parse(${n})`:t===i?"+"+n:t[0]===u?`${n} === '${t.slice(2)}' ? true : false`:n,{repl:c}=l;return`${void 0!==c.empty?`${n} === '' ? ${c.empty} : `:""} ${void 0!==c.null?`${n} === 'null' || ${n} === 'NULL' ? ${c.null} : `:""} ${void 0!==c.NaN&&t===i?`${n} === 'NaN' ? ${c.NaN} : `:""} ${f}`}const c=/\w+(?:\[|\]?[\.\[]?|$)/gm;function o(e,l=!1,t=!1){let n="";if(l&&t){let l={},t=0,r=e.map((e=>e.name));do{let e=r.shift(),n=/\s/.test(e)?[e]:[...e.matchAll(c)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=n.shift(),l=e,r=e.at(-1);"."==r||"["==r?(l=e.slice(0,-1),i=i[l]=i[l]??("."==r?{}:[])):i[l]=`¦${t}¦`}while(n.length>0);t++}while(r.length>0);n=JSON.stringify(l).replace(/"¦(\d+)¦"/g,((l,t)=>f(+t,e[+t])))}else n=l?"{":"[",e.forEach(((e,t)=>{n+=l?`"${e.name.replaceAll('"','\\"')}":`:"";let r=f(t,e);n+=r+","})),n+=l?"}":"]";return Function("rows",` let arr = Array(rows.length); for (let i = 0; i < rows.length; i++) { let r = rows[i]; arr[i] = ${n}; } return arr; `)}function a(e,l,t,n=0,r=!0,i=1e3,s=null,u=null){let[f,c,o]=l.delims,a=u||l.cols.length,h=null!=s,d=null!=u&&h,p=f.length,g=c.length,$=0,y=0,m=e.length-1,A=0,N=[],k=Array(a).fill(""),w=k.slice(),O=0,b=a-1,x=-1;if(""===o){for(;m>=y;)if(O===b){let l=e.indexOf(f,y);if(-1===l){if(!r)break;l=m+1}if(w[O]=e.slice(y,l),0>--n&&N.push(w),N.length===i){let e=!1===t(N,"");if(N=[],e||h&&++$===s)return}w=k.slice(),O=0,x=-1,y=l+p,A=y}else{let l=e.indexOf(c,y);if(-1===l&&!r)break;w[O]=e.slice(y,l),y=l+g,x=O++}return void(r&&0>=N.length||t(N,r?"":e.slice(A)))}let C=o.charCodeAt(0),E=f.charCodeAt(0),v=c.charCodeAt(0);const S=d?RegExp(`[^${c}${f}]+`,"my"):null;let T,j=0,L="";for(;m>=y;){if(T=e.charCodeAt(y),0===j)if(T===C){if(j=2,y+=1,y>m)break;T=e.charCodeAt(y)}else if(T===v||T===E){if(w[O]=L,x=O,O+=1,y+=1,L="",T===E){if(d&&b>x&&0===N.length&&(w.length=k.length=x+1,b=x),0>--n&&N.push(w),N.length===i){let e=!1===t(N,"");if(N=[],e||h&&++$===s)return}w=k.slice(),O=0,x=-1,y+=p-1,A=y}if(y>m)break;T=e.charCodeAt(y)}else j=1;if(2===j)for(;;)if(T===C){if(y+1>m){y=m+1;break}if(e.charCodeAt(y+1)!==C){j=0,y+=1;break}if(L+=o,y+=2,y>m){y=m+1;break}T=e.charCodeAt(y)}else{let l=e.indexOf(o,y);if(-1===l){y=m+1;break}L+=e.slice(y,l),y=l,T=C}else if(1===j)if(T===v||T===E){if(w[O]=L,x=O,O+=1,y+=1,L="",T===E){if(d&&b>x&&0===N.length&&(w.length=k.length=x+1,b=x),0>--n&&N.push(w),N.length===i){let e=!1===t(N,"");if(N=[],e||h&&++$===s)return}w=k.slice(),O=0,x=-1,y+=p-1,A=y}j=0}else if(d){S.lastIndex=y;let l=S.exec(e)[0];L+=l,y+=l.length}else{let l=e.indexOf(O===b?f:c,y);-1===l&&(l=m+1),L+=e.slice(y,l),y=l}}r&&O===b&&(w[O]=L,0>--n&&N.push(w),j=0),t(N,r||0===j&&!(-1===x?""!==L:b>x)?"":e.slice(A))}return e.inferSchema=function(e,f,c,o,h,d){f??=e=>[e[0]],d??=10;const p=RegExp(`(.*)(${h??"\r\n|\r|\n"})`),g=e.match(p),$=g[1];h??=g[2],c??=n.find((e=>$.indexOf(e)>-1))??"",o??=e.indexOf('"')>-1?'"':"";const y={skip:1,delims:[h,c,o],cols:[]},m=$.split(c).length,A=[];a(e,y,(e=>{A.push(...e)}),0,!0,d,1,m);let N=f(A)??[],k=y.skip=N.length,w=N.find((e=>null!=e))??[...Array(A[0].length).keys()];return A.splice(0,k),w.forEach(((e,n)=>{let f=function(e,n){let f=n.find((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),c="s";if(null!=f){let n=f[e];c=l.test(n)?r:+n==+n?i:t.test(n)?u+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(n):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(n)?s:c}return c}(n,A);y.cols.push({name:e,type:f,repl:{empty:null,NaN:void 0,null:void 0}})})),y},e.initParser=function(e,l){let{skip:t,cols:n}=e,r=null,i=null,s=null,u=null,f=null,c=0,h=0,d=null,p=null,g="",$="",y=null;function m(){h=c=0,$=g="",d=p=y=null}let A=(e,l)=>{l(e)},N=()=>[],k=e=>{y.push(...e)};function w(n,r,i){let s=null;return(u,f=A)=>{s??=i(),y??=n();let o=y,d=0===h||2===h;return a(u,e,((e,l)=>{$=l;let t=f(s(e),r);return!1===t&&0!==h&&m(),t}),0===c?t:0,d,l),d&&(y=null),o}}const O=w(N,k,(()=>(r??=e=>e,r))),b=w(N,k,(()=>(i??=o(n,!1,!1),i))),x=w(N,k,(()=>(s??=o(n,!0,!1),s))),C=w(N,k,(()=>(u??=o(n,!0,!0),u))),E=w((()=>n.map((()=>[]))),(e=>{e.forEach(((e,l)=>{y[l].push(...e)}))}),(()=>(i??=o(n,!1,!1),f??=function(e){return Function("rows",` let cols = [${e.map((()=>"Array(rows.length)")).join(",")}]; for (let i = 0; i < rows.length; i++) { let r = rows[i]; ${e.map(((e,l)=>`cols[${l}][i] = r[${l}]`)).join(";")}; } return cols; `)}(n),e=>f(i(e)))));return{schema:e,stringArrs:O,typedArrs:b,typedObjs:x,typedDeep:C,typedCols:E,chunk(e,l=O,t=A){d??=l,p??=t;let n=null;return 1===h&&(n=d($+g,p),c++),g=e,h=1,n},end(){h=2;let e=d($+g,p);return m(),e}}},e}({});
