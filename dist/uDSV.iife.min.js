/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,r=["\t","|",";",","],n="d",i="n",s="j",c="b";function u(e,l){let{type:t}=l,r=`r[${e}]`,u=t===n?`new Date(${r})`:t===s?`JSON.parse(${r})`:t===i?"+"+r:t[0]===c?`${r} === '${t.slice(2)}' ? true : false`:r,{repl:o}=l;return`${void 0!==o.empty?`${r} === '' ? ${o.empty} : `:""} ${void 0!==o.null?`${r} === 'null' || ${r} === 'NULL' ? ${o.null} : `:""} ${void 0!==o.NaN&&t===i?`${r} === 'NaN' ? ${o.NaN} : `:""} ${u}`}const o=/\w+(?:\[|\]?[\.\[]?|$)/gm;function f(e,l=!1,t=!1){let r="";if(l&&t){let l={},t=0,n=e.map((e=>e.name));do{let e=n.shift(),r=/\s/.test(e)?[e]:[...e.matchAll(o)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=r.shift(),l=e,n=e.at(-1);"."==n||"["==n?(l=e.slice(0,-1),i=i[l]=i[l]??("."==n?{}:[])):i[l]=`¦${t}¦`}while(r.length>0);t++}while(n.length>0);r=JSON.stringify(l).replace(/"¦(\d+)¦"/g,((l,t)=>u(+t,e[+t])))}else!l&&e.every((e=>"s"===e.type))?r="r":(r=l?"{":"[",e.forEach(((e,t)=>{r+=l?`"${e.name.replaceAll('"','\\"')}":`:"";let n=u(t,e);r+=n+","})),r+=l?"}":"]");return Function("rows",` let arr = Array(rows.length); for (let i = 0; i < rows.length; i++) { let r = rows[i]; arr[i] = ${r}; } return arr; `)}function a(e,l,t,r=0,n=!0,i=1e3,s=null,c=null){let{row:u,col:o,encl:f,esc:a,trim:h}=l,d=c||l.cols.length,p=null!=s,g=null!=c&&p,$=u.length,m=o.length,y=0,A=0,N=e.length-1,k=0,w=[],C=Array(d).fill(""),b=C.slice(),O=0,x=d-1,v=-1;if(""===f){for(;N>=A;)if(O===x){let l=e.indexOf(u,A);if(-1===l){if(!n)break;l=N+1}let c=e.slice(A,l);if(b[O]=h?c.trim():c,0>--r&&w.push(b),w.length===i){let e=!1===t(w,"");if(w=[],e||p&&++y===s)return}b=C.slice(),O=0,v=-1,A=l+$,k=A}else{let l=e.indexOf(o,A);if(-1===l&&!n)break;let t=e.slice(A,l);b[O]=h?t.trim():t,A=l+m,v=O++}return void(n&&0>=w.length||t(w,n?"":e.slice(k)))}let E=f.charCodeAt(0),S=a.charCodeAt(0),L=u.charCodeAt(0),T=o.charCodeAt(0);const j=g?RegExp(`[^${o}${u}]+`,"my"):null;let R,Y=0,D="";for(;N>=A;){if(R=e.charCodeAt(A),0===Y)if(R===E){if(Y=2,A+=1,A>N)break;R=e.charCodeAt(A)}else if(R===T||R===L){if(b[O]=D,v=O,O+=1,A+=1,D="",R===L){if(g&&x>v&&0===w.length&&(b.length=C.length=v+1,x=v),0>--r&&w.push(b),w.length===i){let e=!1===t(w,"");if(w=[],e||p&&++y===s)return}b=C.slice(),O=0,v=-1,A+=$-1,k=A}if(A>N)break;R=e.charCodeAt(A)}else if(h&&32===R)for(;32===R;)R=e.charCodeAt(++A);else Y=1;if(2===Y)for(;;)if(R===E)if(E===S){if(A+1>N){A=N+1;break}if(e.charCodeAt(A+1)!==E){Y=0,A+=1;break}if(A+=2,D+=f,A>N)break;R=e.charCodeAt(A)}else{if(e.charCodeAt(A-1)!==S){Y=0,A+=1;break}if(A+=1,D+=f,A>N)break;R=e.charCodeAt(A)}else{let l=e.indexOf(f,A);if(-1===l){A=N+1;break}D+=e.slice(A,E===S?l:l-1),A=l,R=E}else if(1===Y)if(R===T||R===L){if(b[O]=D,v=O,O+=1,A+=1,D="",R===L){if(g&&x>v&&0===w.length&&(b.length=C.length=v+1,x=v),0>--r&&w.push(b),w.length===i){let e=!1===t(w,"");if(w=[],e||p&&++y===s)return}b=C.slice(),O=0,v=-1,A+=$-1,k=A}Y=0}else if(g){j.lastIndex=A;let l=j.exec(e)[0];D+=l,A+=l.length}else{let l=e.indexOf(O===x?u:o,A);-1===l&&(l=N+1);let t=e.slice(A,l);D+=h?t.trim():t,A=l}}n&&O===x&&(b[O]=D,0>--r&&w.push(b),Y=0),t(w,n||0===Y&&!(-1===v?""!==D:x>v)?"":e.slice(k))}return e.inferSchema=function(e,u,o){let{header:f,col:h,row:d,encl:p,esc:g,trim:$=!1}=u??{};f??=e=>[e[0]],o??=10;const m=RegExp(`(.*)(${d??"\r\n|\r|\n"})`),y=e.match(m),A=y[1];d??=y[2],h??=r.find((e=>A.indexOf(e)>-1))??"",p??=e.indexOf('"')>-1?'"':"",g??=p;const N={skip:1,col:h,row:d,encl:p,esc:g,trim:$,cols:[]},k=A.split(h).length,w=[];a(e,N,(e=>{w.push(...e)}),0,!0,o,1,k);let C=f(w)??[],b=N.skip=C.length,O=C.find((e=>null!=e))??[...Array(w[0].length).keys()];return w.splice(0,b),O.forEach(((e,r)=>{let u=function(e,r){let u=r.findLast((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),o="s";if(null!=u){let r=u[e];o=l.test(r)?n:+r==+r?i:t.test(r)?c+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(r):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(r)?s:o}return o}(r,w);N.cols.push({name:e,type:u,repl:{empty:null,NaN:void 0,null:void 0}})})),N},e.initParser=function(e,l){let{skip:t,cols:r}=e,n=null,i=null,s=null,c=null,u=null,o=0,h=0,d=null,p=null,g="",$="",m=null;function y(){h=o=0,$=g="",d=p=m=null}let A=(e,l)=>{l(e)},N=()=>[],k=e=>{m.push(...e)};function w(r,n,i){let s=null;return(c,u=A)=>{s??=i(),m??=r();let f=m,d=0===h||2===h;return a(c,e,((e,l)=>{$=l;let t=u(s(e),n);return!1===t&&0!==h&&y(),t}),0===o?t:0,d,l),d&&(m=null),f}}const C=w(N,k,(()=>(n??=e=>e,n))),b=w(N,k,(()=>(i??=f(r,!1,!1),i))),O=w(N,k,(()=>(s??=f(r,!0,!1),s))),x=w(N,k,(()=>(c??=f(r,!0,!0),c))),v=w((()=>r.map((()=>[]))),(e=>{e.forEach(((e,l)=>{m[l].push(...e)}))}),(()=>(i??=f(r,!1,!1),u??=function(e){return Function("rows",` let cols = [${e.map((()=>"Array(rows.length)")).join(",")}]; for (let i = 0; i < rows.length; i++) { let r = rows[i]; ${e.map(((e,l)=>`cols[${l}][i] = r[${l}]`)).join(";")}; } return cols; `)}(r),e=>u(i(e)))));return{schema:e,stringArrs:C,typedArrs:b,typedObjs:O,typedDeep:x,typedCols:v,chunk(e,l=C,t=A){d??=l,p??=t;let r=null;return 1===h&&(r=d($+g,p),o++),g=e,h=1,r},end(){h=2;let e=d($+g,p);return y(),e}}},e}({});
