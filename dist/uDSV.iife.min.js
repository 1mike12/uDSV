/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const t='"',l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,n=["\t","|",";",","];function r(e,t,n=!1){let r=n?"{":"[";return e.forEach(((e,i)=>{r+=n?`"${e}":`:"";let s=`r[${i}]`,u=s,o=t.find((e=>null!=e[i]&&""!==e[i]));if(null!=o){let e=o[i];if(l.test(e))u=`new Date(${s})`;else if(Number.isNaN(Number.parseFloat(e))){if(/^(?:true|false)$/i.test(e))u=`${s} === '${"TRUE"===e||"FALSE"===e?"TRUE":"True"===e||"False"===e?"True":"true"}' ? true : false`;else if("["===e[0]||"{"===e[0])try{JSON.parse(e),u=`JSON.parse(${s})`}catch{}}else u=`${s} === 'NaN' ? NaN : Number.parseFloat(${s})`}r+=`${s} === '' || ${s} === 'null' || ${s} === 'NULL' ? null :  ${u},`})),r+=n?"}":"]",Function("rows",`\n\t\tlet arr = Array(rows.length);\n\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tlet r = rows[i];   // trim()?\n\t\t\tarr[i] = ${r};\n\t\t}\n\n\t\treturn arr;\n\t`)}function i(e,l,n,r=5e3,i=null,s=null){let u=l.cols.delim,o=l.rows.delim,c=s||l.cols.names.length,f=null!=i,a=null!=s&&f,h=o.length,d=0;if(null==l.quote){let t=[],l=0,s=-1;for(;(s=e.indexOf(o,l))>-1&&(t.push(e.slice(l,s).split(u)),l=s+h,t.length!==r||(n(t,d++),t=[],!f||d!==i)););return void(t.length>0&&n(t,d++))}let $=o.charCodeAt(0),m=u.charCodeAt(0);const g=a?RegExp(`[^${u}${o}]+`,"my"):null,p=Array(c).fill("");let A,N=0,O=0,w=e.length-1,x=[],C="",b=p.slice(),F=0,k=c-1;for(;w>=O;){if(A=e.charCodeAt(O),0===N)if(34===A)N=2,O+=1,A=e.charCodeAt(O);else if(A===m||A===$){if(b[F]=C,F+=1,O+=1,C="",A===$){if(x.push(b),x.length===r&&(n(x,d++),x=[],f&&d===i))return;b=p.slice(),F=0,O+=h-1}A=e.charCodeAt(O)}else N=1;if(2===N)for(;;)if(34===A){if(34!==e.charCodeAt(O+1)){N=0,O+=1;break}C+=t,O+=2,A=e.charCodeAt(O)}else{let l=e.indexOf(t,O);C+=e.slice(O,l),O=l,A=34}else if(1===N)if(A===m||A===$){if(b[F]=C,F+=1,O+=1,C="",A===$){if(x.push(b),x.length===r&&(n(x,d++),x=[],f&&d===i))return;b=p.slice(),F=0,O+=h-1}N=0}else if(a){g.lastIndex=O;let t=g.exec(e)[0];C+=t,O+=t.length}else{let t;F===k?(t=e.indexOf(o,O),-1===t&&(t=e.length)):t=e.indexOf(u,O),C+=e.slice(O,t),O=t}}b[F]=C,x.push(b),n(x,d++)}return e.parse=i,e.schema=function(e,l){l??=10;const s=e.match(/(.*)(\r?\n?)/),u=s[1],o=s[2],c=n.find((e=>u.indexOf(e)>-1));let f=e.indexOf(t)>-1,a=null,h=null,d=null;const $={quote:f?t:null,cols:{delim:c,names:[]},rows:{delim:o},toArrs:e=>(a??=r(p,g,!1),a(e)),toObjs:e=>(h??=r(p,g,!0),h(e)),toCols:e=>(d??=function(e){return Function("chunk",`\n\t\tlet cols = [${e.map((()=>"Array(chunk.length)")).join(",")}];\n\n\t\tfor (let i = 0; i < chunk.length; i++) {\n\t\t\tlet row = chunk[i];\n\t\t\t${e.map(((e,t)=>`cols[${t}][i] = row[${t}]`)).join(";")};\n\t\t}\n\n\t\treturn cols;\n\t`)}(p),d(e))},m=u.split(c).length,g=[];i(e,$,(e=>g.push(...e)),l,1,m);const p=Object.values(g.shift());return $.cols.names=p,$},e}({});
