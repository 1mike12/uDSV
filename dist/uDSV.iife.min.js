/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","],r="d",i="n",s="j",u="b";function o(e,l){let{type:t}=l,n=`r[${e}]`,o=t===r?`new Date(${n})`:t===s?`JSON.parse(${n})`:t===i?`Number.parseFloat(${n})`:t[0]===u?`${n} === '${t.slice(2)}' ? true : false`:n,{repl:f}=l;return`${void 0!==f.empty?`${n} === '' ? ${f.empty} : `:""} ${void 0!==f.null?`${n} === 'null' || ${n} === 'NULL' ? ${f.null} : `:""} ${void 0!==f.NaN&&t===i?`${n} === 'NaN' ? ${f.NaN} : `:""} ${o}`}const f=/\w+(?:\[|\]?[\.\[]?|$)/gm;function a(e,l=!1,t=!1){let n="";if(l&&t){let l={},t=0,r=e.map((e=>e.name));do{let e=r.shift(),n=/\s/.test(e)?[e]:[...e.matchAll(f)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=n.shift(),l=e,r=e.at(-1);"."==r||"["==r?(l=e.slice(0,-1),i=i[l]=i[l]??("."==r?{}:[])):i[l]=`¦${t}¦`}while(n.length>0);t++}while(r.length>0);n=JSON.stringify(l).replace(/"¦(\d+)¦"/g,((l,t)=>o(+t,e[+t])))}else n=l?"{":"[",e.forEach(((e,t)=>{n+=l?`"${e.name.replaceAll('"','\\"')}":`:"";let r=o(t,e);n+=r+","})),n+=l?"}":"]";return Function("rows",` let arr = Array(rows.length); for (let i = 0; i < rows.length; i++) { let r = rows[i]; arr[i] = ${n}; } return arr; `)}function c(e,l,t,n=0,r=!0,i=1e3,s=null,u=null){let[o,f,a]=l.delims,c=u||l.cols.length,h=null!=s,d=null!=u&&h,p=o.length,$=0;if(!d&&""===a){let l=e.split(o),n="",u=l.length;r||(u-=1,n=l[u]);let a=[];for(let e=0;u>e;e++){let n=l[e].split(f);if(a.push(n),a.length===i&&(t(a,""),a=[],h&&++$===s))return}return void((a.length>0||""!==n)&&t(a,n))}let g=""==a?0:a.charCodeAt(0),m=o.charCodeAt(0),N=f.charCodeAt(0);const y=d?RegExp(`[^${f}${o}]+`,"my"):null,A=Array(c).fill("");let w,b=0,k=0,C=e.length-1,O=0,x=[],E="",v=A.slice(),S=0,F=c-1,T=-1;for(;C>=k;){if(w=e.charCodeAt(k),0===b)if(w===g){if(b=2,k+=1,k>C)break;w=e.charCodeAt(k)}else if(w===N||w===m){if(v[S]=E,T=S,S+=1,k+=1,E="",w===m){if(d&&F>T&&0===x.length&&(v.length=A.length=T+1,F=T),0>--n&&x.push(v),x.length===i){let e=!1===t(x,"");if(x=[],e||h&&++$===s)return}v=A.slice(),S=0,T=-1,k+=p-1,O=k}if(k>C)break;w=e.charCodeAt(k)}else b=1;if(2===b)for(;;)if(w===g){if(k+1>C){k=C+1;break}if(e.charCodeAt(k+1)!==g){b=0,k+=1;break}if(E+=a,k+=2,k>C){k=C+1;break}w=e.charCodeAt(k)}else{let l=e.indexOf(a,k);if(-1===l){k=C+1;break}E+=e.slice(k,l),k=l,w=g}else if(1===b)if(w===N||w===m){if(v[S]=E,T=S,S+=1,k+=1,E="",w===m){if(d&&F>T&&0===x.length&&(v.length=A.length=T+1,F=T),0>--n&&x.push(v),x.length===i){let e=!1===t(x,"");if(x=[],e||h&&++$===s)return}v=A.slice(),S=0,T=-1,k+=p-1,O=k}b=0}else if(d){y.lastIndex=k;let l=y.exec(e)[0];E+=l,k+=l.length}else{let l=e.indexOf(S===F?o:f,k);-1===l&&(l=C+1),E+=e.slice(k,l),k=l}}r&&S===F&&(v[S]=E,0>--n&&x.push(v),b=0),t(x,r||0===b&&!(-1===T?""!==E:F>T)?"":e.slice(O))}return e.inferSchema=function(e,o,f,a,h,d){o??=e=>[e[0]],d??=10;const p=RegExp(`(.*)(${h??"\r\n|\r|\n"})`),$=e.match(p),g=$[1];h??=$[2],f??=n.find((e=>g.indexOf(e)>-1))??"",a??=e.indexOf('"')>-1?'"':"";const m={skip:1,delims:[h,f,a],cols:[]},N=g.split(f).length,y=[];c(e,m,(e=>{y.push(...e)}),0,!0,d,1,N);let A=o(y)??[],w=m.skip=A.length,b=A.find((e=>null!=e));return y.splice(0,w),b.forEach(((e,n)=>{let o=function(e,n){let o=n.find((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),f="s";if(null!=o){let n=o[e];f=l.test(n)?r:Number.isNaN(Number.parseFloat(n))?t.test(n)?u+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(n):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(n)?s:f:i}return f}(n,y);m.cols.push({name:e,type:o,repl:{empty:null,NaN:void 0,null:void 0}})})),m},e.initParser=function(e,l){let{skip:t,cols:n}=e,r=null,i=null,s=null,u=null,o=null,f=0,h=0,d=null,p=null,$="",g="",m=null;function N(){h=f=0,g=$="",d=p=m=null}let y=(e,l)=>{l(e)},A=()=>[],w=e=>{m.push(...e)};function b(n,r,i){let s=null;return(u,o=y)=>{s??=i(),m??=n();let a=m,d=0===h||2===h;return c(u,e,((e,l)=>{g=l;let t=o(s(e),r);return!1===t&&0!==h&&N(),t}),0===f?t:0,d,l),d&&(m=null),a}}const k=b(A,w,(()=>(r??=e=>e,r))),C=b(A,w,(()=>(i??=a(n,!1,!1),i))),O=b(A,w,(()=>(s??=a(n,!0,!1),s))),x=b(A,w,(()=>(u??=a(n,!0,!0),u))),E=b((()=>n.map((()=>[]))),(e=>{e.forEach(((e,l)=>{m[l].push(...e)}))}),(()=>(i??=a(n,!1,!1),o??=function(e){return Function("rows",` let cols = [${e.map((()=>"Array(rows.length)")).join(",")}]; for (let i = 0; i < rows.length; i++) { let r = rows[i]; ${e.map(((e,l)=>`cols[${l}][i] = r[${l}]`)).join(";")}; } return cols; `)}(n),e=>o(i(e)))));return{schema:e,stringArrs:k,typedArrs:C,typedObjs:O,typedDeep:x,typedCols:E,chunk(e,l=k,t=y){d??=l,p??=t;let n=null;return 1===h&&(n=d(g+$,p),f++),$=e,h=1,n},end(){h=2;let e=d(g+$,p);return N(),e}}},e}({});
