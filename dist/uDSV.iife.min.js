/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(t){"use strict";const e=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,l=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","];function r(t,n){let r=n.find((e=>""!==e[t]&&"null"!==e[t]&&"NULL"!==e[t]&&"NaN"!==e[t])),i="string";if(null!=r){let n=r[t];i=e.test(n)?"date":Number.isNaN(Number.parseFloat(n))?l.test(n)?"boolean:"+function(t){let[e,l=""]=t;return"1"==e||"0"==e?"1":"t"==e||"f"==e?""==l?"t":"true":"T"==e||"F"==e?""==l?"T":"R"==l||"A"===l?"TRUE":"True":"y"==e||"n"==e?""==l?"y":"yes":"Y"==e||"N"==e?""==l?"Y":"E"==l||"O"===l?"YES":"Yes":""}(n):function(t){if("["===t[0]||"{"===t[0])try{return JSON.parse(t),!0}catch{}return!1}(n)?"json":i:"number"}return i}function i(t,e){let{type:l}=e,n=`r[${t}]`,r="date"===l?`new Date(${n})`:"json"===l?`JSON.parse(${n})`:"number"===l?`Number.parseFloat(${n})`:l.startsWith("boolean")?`${n} === '${l.slice(8)}' ? true : false`:n;return`${void 0!==e.empty?`${n} === '' ? ${e.empty} : `:""} ${void 0!==e.null?`${n} === 'null' || ${n} === 'NULL' ? ${e.null} : `:""} ${void 0!==e.NaN&&"number"===l?`${n} === 'NaN' ? ${e.NaN} : `:""} ${r}`}const s=/\w+(?:\[|\]?[\.\[]?|$)/gm;function o(t,e=!1,l=!1){let n="";if(e&&l){let e={},l=0,r=t.map((t=>t.name));do{let t=r.shift(),n=/\s/.test(t)?[t]:[...t.matchAll(s)].flatMap((t=>t.map((t=>t.replace("]",""))))),i=e;do{let t=n.shift(),e=t,r=t.at(-1);"."==r||"["==r?(e=t.slice(0,-1),i=i[e]=i[e]??("."==r?{}:[])):i[e]=`¦${l}¦`}while(n.length>0);l++}while(r.length>0);n=JSON.stringify(e).replace(/"¦(\d+)¦"/g,((e,l)=>i(+l,t[+l])))}else n=e?"{":"[",t.forEach(((t,l)=>{n+=e?`"${t.name.replaceAll('"','\\"')}":`:"";let r=i(l,t);n+=r+","})),n+=e?"}":"]";return Function("rows",`\n\t\tlet arr = Array(rows.length);\n\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tlet r = rows[i];   // trim()?\n\t\t\tarr[i] = ${n};\n\t\t}\n\n\t\treturn arr;\n\t`)}function u(t,e,l,n=!0,r=5e3,i=null,s=null){let o=e.delims.col,u=e.delims.row,a=e.quote??"",c=s||e.cols.length,f=null!=i,h=null!=s&&f,d=u.length,p=0;if(""===a){let e=t.split(u),s="",a=e.length;n||(a-=1,s=e[a]);let c=[];for(let t=0;a>t;t++){let n=e[t].split(o);if(c.push(n),c.length===r&&(l(c,p++,""),c=[],f&&p===i))return}return void((c.length>0||""!==s)&&l(c,p++,s))}let $=""==a?0:a.charCodeAt(0),g=u.charCodeAt(0),m=o.charCodeAt(0);const N=h?RegExp(`[^${o}${u}]+`,"my"):null,b=Array(c).fill("");let y,A=0,w=0,k=t.length-1,C=0,O=[],v="",x=b.slice(),E=0,j=c-1,F=-1;for(;k>=w;){if(y=t.charCodeAt(w),0===A)if(y===$){if(A=2,w+=1,w>k)break;y=t.charCodeAt(w)}else if(y===m||y===g){if(x[E]=v,F=E,E+=1,w+=1,v="",y===g){if(h&&j>F&&0===O.length&&(x.length=b.length=F+1,j=F),O.push(x),O.length===r&&(l(O,p++,""),O=[],f&&p===i))return;x=b.slice(),E=0,F=-1,w+=d-1,C=w}if(w>k)break;y=t.charCodeAt(w)}else A=1;if(2===A)for(;;)if(y===$){if(w+1>k){w=k+1;break}if(t.charCodeAt(w+1)!==$){A=0,w+=1;break}if(v+=a,w+=2,w>k){w=k+1;break}y=t.charCodeAt(w)}else{let e=t.indexOf(a,w);if(-1===e){w=k+1;break}v+=t.slice(w,e),w=e,y=$}else if(1===A)if(y===m||y===g){if(x[E]=v,F=E,E+=1,w+=1,v="",y===g){if(h&&j>F&&0===O.length&&(x.length=b.length=F+1,j=F),O.push(x),O.length===r&&(l(O,p++,""),O=[],f&&p===i))return;x=b.slice(),E=0,F=-1,w+=d-1,C=w}A=0}else if(h){N.lastIndex=w;let e=N.exec(t)[0];v+=e,w+=e.length}else{let e=t.indexOf(E===j?u:o,w);-1===e&&(e=k+1),v+=t.slice(w,e),w=e}}n&&E===j&&(x[E]=v,O.push(x),A=0),l(O,p++,n||0===A&&!(-1===F?""!==v:j>F)?"":t.slice(C))}return t.parse=u,t.schema=function(t,e){e??=10;const l=t.match(/(.*)(\r?\n?)/),i=l[1],s=l[2],a=n.find((t=>i.indexOf(t)>-1));let c=t.indexOf('"')>-1,f=null,h=null,d=null,p=null;const $={quote:c?'"':null,delims:{row:s,col:a},cols:[],toArrs:t=>(f??=o($.cols,!1,!1),f(t)),toObjs:t=>(h??=o($.cols,!0,!1),h(t)),toDeep:t=>(p??=o($.cols,!0,!0),p(t)),toCols:t=>(d??=function(t){return Function("chunk",`\n\t\tlet cols = [${t.map((()=>"Array(chunk.length)")).join(",")}];\n\n\t\tfor (let i = 0; i < chunk.length; i++) {\n\t\t\tlet row = chunk[i];\n\t\t\t${t.map(((t,e)=>`cols[${e}][i] = row[${e}]`)).join(";")};\n\t\t}\n\n\t\treturn cols;\n\t`)}($.cols),d(t))},g=1024*e,m=i.split(a).length,N=[];return u(t.slice(0,g),$,(t=>N.push(...t)),g>=t.length,e,1,m),N.shift().forEach(((t,e)=>{$.cols.push({name:t,type:r(e,N),empty:null,NaN:void 0,null:void 0})})),$},t}({});
