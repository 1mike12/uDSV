/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const t='"',l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,n=["\t","|",";",","];function r(e,l,n,r=5e3,i=null,s=null){let u=l.cols.delim,f=l.rows.delim,o=s||l.cols.names.length,a=null!=i,d=null!=s&&a,c=f.length,h=0;if(null==l.quote){let t=[],l=0,s=-1;for(;(s=e.indexOf(f,l))>-1&&(t.push(e.slice(l,s).split(u)),l=s+c,t.length!==r||(n(t,h++),t=[],!a||h!==i)););return void(t.length>0&&n(t,h++))}let p=f.charCodeAt(0),m=u.charCodeAt(0);const $=d?RegExp(`[^${u}${f}]+`,"my"):null;let g,A=0,x=0,O=e.length-1,w=[],y="",C=Array(o),N=0,b=o-1;for(;O>=x;){if(g=e.charCodeAt(x),0===A)if(34===g)A=2,x+=1,g=e.charCodeAt(x);else if(g===m||g===p){if(C[N]=y,N+=1,x+=1,y="",g===p){if(w.push(C),w.length===r&&(n(w,h++),w=[],a&&h===i))return;C=Array(o),N=0,x+=c-1}g=e.charCodeAt(x)}else A=1;if(2===A)for(;;)if(34===g){if(34!==e.charCodeAt(x+1)){A=0,x+=1;break}y+=t,x+=2,g=e.charCodeAt(x)}else{let l=e.indexOf(t,x);y+=e.slice(x,l),x=l,g=34}else if(1===A)if(g===m||g===p){if(C[N]=y,N+=1,x+=1,y="",g===p){if(w.push(C),w.length===r&&(n(w,h++),w=[],a&&h===i))return;C=Array(o),N=0,x+=c-1}A=0}else if(d){$.lastIndex=x;let t=$.exec(e)[0];y+=t,x+=t.length}else{let t;N===b?(t=e.indexOf(f,x),-1===t&&(t=e.length)):t=e.indexOf(u,x),y+=e.slice(x,t),x=t}}C[N]=y,w.push(C),n(w,h++)}return e.parse=r,e.schema=function(e,i,s){i??=10,s??=!1;const u=e.match(/(.*)(\r?\n?)/),f=u[1],o=u[2],a=n.find((e=>f.indexOf(e)>-1)),d={quote:e.indexOf(t)>-1?t:null,cols:{delim:a,names:[]},rows:{delim:o},toTyped:null},c=f.split(a).length,h=[];r(e,d,(e=>h.push(...e)),i,1,c);const p=Object.values(h.shift());return d.cols.names=p,d.toTyped=function(e,t,n=!1){let r=n?"{":"[";return e.forEach(((e,i)=>{r+=n?`"${e}":`:"";let s=`r[${i}]`,u=s,f=t.find((e=>null!=e[i]&""!==e[i]));if(null!=f){let e=f[i];if(l.test(e))u=`new Date(${s})`;else if(Number.isNaN(Number.parseFloat(e))){if(/^(?:true|false)$/i.test(e))u=s+".toLowerCase() === 'true' ? true : false";else if("["===e[0]||"{"===e[0])try{JSON.parse(e),u=`JSON.parse(${s})`}catch{}}else u=`Number.parseFloat(${s})`}r+=`${s} === '' || ${s} == null ? undefined : ${s} === 'null' ? null :  ${u},`})),r+=n?"}":"]",Function("rows",`\n\t\tlet arr = Array(rows.length);\n\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tlet r = rows[i];   // trim()?\n\t\t\tarr[i] = ${r};\n\t\t}\n\n\t\treturn arr;\n\t`)}(p,h,s),d},e}({});
