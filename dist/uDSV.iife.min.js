/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,t=/^(?:t(?:rue)?|f(?:alse)?|y(?:es)?|n(?:o)?|0|1)$/i,n=["\t","|",";",","],r="d",i="n",s="j",u="b";function f(e,l){let{type:t}=l,n=`r[${e}]`,f=t===r?`new Date(${n})`:t===s?`JSON.parse(${n})`:t===i?`Number.parseFloat(${n})`:t[0]===u?`${n} === '${t.slice(2)}' ? true : false`:n,{repl:o}=l;return`${void 0!==o.empty?`${n} === '' ? ${o.empty} : `:""} ${void 0!==o.null?`${n} === 'null' || ${n} === 'NULL' ? ${o.null} : `:""} ${void 0!==o.NaN&&t===i?`${n} === 'NaN' ? ${o.NaN} : `:""} ${f}`}const o=/\w+(?:\[|\]?[\.\[]?|$)/gm;function c(e,l=!1,t=!1){let n="";if(l&&t){let l={},t=0,r=e.map((e=>e.name));do{let e=r.shift(),n=/\s/.test(e)?[e]:[...e.matchAll(o)].flatMap((e=>e.map((e=>e.replace("]",""))))),i=l;do{let e=n.shift(),l=e,r=e.at(-1);"."==r||"["==r?(l=e.slice(0,-1),i=i[l]=i[l]??("."==r?{}:[])):i[l]=`¦${t}¦`}while(n.length>0);t++}while(r.length>0);n=JSON.stringify(l).replace(/"¦(\d+)¦"/g,((l,t)=>f(+t,e[+t])))}else n=l?"{":"[",e.forEach(((e,t)=>{n+=l?`"${e.name.replaceAll('"','\\"')}":`:"";let r=f(t,e);n+=r+","})),n+=l?"}":"]";return Function("rows",` let arr = Array(rows.length); for (let i = 0; i < rows.length; i++) { let r = rows[i]; arr[i] = ${n}; } return arr; `)}function a(e,l,t,n=0,r=!0,i=1e3,s=null,u=null){let[f,o,c]=l.delims,a=u||l.cols.length,h=null!=s,d=null!=u&&h,p=f.length,$=o.length,g=0,m=0,N=e.length-1,y=0,A=[],b=Array(a).fill(""),k=b.slice(),w=0,O=a-1,x=-1;if(""===c){for(;N>=m;)if(w===O){let l=e.indexOf(f,m);if(-1===l){if(!r)break;l=N+1}if(k[w]=e.slice(m,l),0>--n&&A.push(k),A.length===i){let e=!1===t(A,"");if(A=[],e||h&&++g===s)return}k=b.slice(),w=0,x=-1,m=l+p,y=m}else{let l=e.indexOf(o,m);if(-1===l&&!r)break;k[w]=e.slice(m,l),m=l+$,x=w++}return void(r&&0>=A.length||t(A,r?"":e.slice(y)))}let C=c.charCodeAt(0),E=f.charCodeAt(0),v=o.charCodeAt(0);const S=d?RegExp(`[^${o}${f}]+`,"my"):null;let F,T=0,j="";for(;N>=m;){if(F=e.charCodeAt(m),0===T)if(F===C){if(T=2,m+=1,m>N)break;F=e.charCodeAt(m)}else if(F===v||F===E){if(k[w]=j,x=w,w+=1,m+=1,j="",F===E){if(d&&O>x&&0===A.length&&(k.length=b.length=x+1,O=x),0>--n&&A.push(k),A.length===i){let e=!1===t(A,"");if(A=[],e||h&&++g===s)return}k=b.slice(),w=0,x=-1,m+=p-1,y=m}if(m>N)break;F=e.charCodeAt(m)}else T=1;if(2===T)for(;;)if(F===C){if(m+1>N){m=N+1;break}if(e.charCodeAt(m+1)!==C){T=0,m+=1;break}if(j+=c,m+=2,m>N){m=N+1;break}F=e.charCodeAt(m)}else{let l=e.indexOf(c,m);if(-1===l){m=N+1;break}j+=e.slice(m,l),m=l,F=C}else if(1===T)if(F===v||F===E){if(k[w]=j,x=w,w+=1,m+=1,j="",F===E){if(d&&O>x&&0===A.length&&(k.length=b.length=x+1,O=x),0>--n&&A.push(k),A.length===i){let e=!1===t(A,"");if(A=[],e||h&&++g===s)return}k=b.slice(),w=0,x=-1,m+=p-1,y=m}T=0}else if(d){S.lastIndex=m;let l=S.exec(e)[0];j+=l,m+=l.length}else{let l=e.indexOf(w===O?f:o,m);-1===l&&(l=N+1),j+=e.slice(m,l),m=l}}r&&w===O&&(k[w]=j,0>--n&&A.push(k),T=0),t(A,r||0===T&&!(-1===x?""!==j:O>x)?"":e.slice(y))}return e.inferSchema=function(e,f,o,c,h,d){f??=e=>[e[0]],d??=10;const p=RegExp(`(.*)(${h??"\r\n|\r|\n"})`),$=e.match(p),g=$[1];h??=$[2],o??=n.find((e=>g.indexOf(e)>-1))??"",c??=e.indexOf('"')>-1?'"':"";const m={skip:1,delims:[h,o,c],cols:[]},N=g.split(o).length,y=[];a(e,m,(e=>{y.push(...e)}),0,!0,d,1,N);let A=f(y)??[],b=m.skip=A.length,k=A.find((e=>null!=e));return y.splice(0,b),k.forEach(((e,n)=>{let f=function(e,n){let f=n.find((l=>""!==l[e]&&"null"!==l[e]&&"NULL"!==l[e]&&"NaN"!==l[e])),o="s";if(null!=f){let n=f[e];o=l.test(n)?r:Number.isNaN(Number.parseFloat(n))?t.test(n)?u+":"+function(e){let[l,t=""]=e;return"1"==l||"0"==l?"1":"t"==l||"f"==l?""==t?"t":"true":"T"==l||"F"==l?""==t?"T":"R"==t||"A"===t?"TRUE":"True":"y"==l||"n"==l?""==t?"y":"yes":"Y"==l||"N"==l?""==t?"Y":"E"==t||"O"===t?"YES":"Yes":""}(n):function(e){if("["===e[0]||"{"===e[0])try{return JSON.parse(e),!0}catch{}return!1}(n)?s:o:i}return o}(n,y);m.cols.push({name:e,type:f,repl:{empty:null,NaN:void 0,null:void 0}})})),m},e.initParser=function(e,l){let{skip:t,cols:n}=e,r=null,i=null,s=null,u=null,f=null,o=0,h=0,d=null,p=null,$="",g="",m=null;function N(){h=o=0,g=$="",d=p=m=null}let y=(e,l)=>{l(e)},A=()=>[],b=e=>{m.push(...e)};function k(n,r,i){let s=null;return(u,f=y)=>{s??=i(),m??=n();let c=m,d=0===h||2===h;return a(u,e,((e,l)=>{g=l;let t=f(s(e),r);return!1===t&&0!==h&&N(),t}),0===o?t:0,d,l),d&&(m=null),c}}const w=k(A,b,(()=>(r??=e=>e,r))),O=k(A,b,(()=>(i??=c(n,!1,!1),i))),x=k(A,b,(()=>(s??=c(n,!0,!1),s))),C=k(A,b,(()=>(u??=c(n,!0,!0),u))),E=k((()=>n.map((()=>[]))),(e=>{e.forEach(((e,l)=>{m[l].push(...e)}))}),(()=>(i??=c(n,!1,!1),f??=function(e){return Function("rows",` let cols = [${e.map((()=>"Array(rows.length)")).join(",")}]; for (let i = 0; i < rows.length; i++) { let r = rows[i]; ${e.map(((e,l)=>`cols[${l}][i] = r[${l}]`)).join(";")}; } return cols; `)}(n),e=>f(i(e)))));return{schema:e,stringArrs:w,typedArrs:O,typedObjs:x,typedDeep:C,typedCols:E,chunk(e,l=w,t=y){d??=l,p??=t;let n=null;return 1===h&&(n=d(g+$,p),o++),$=e,h=1,n},end(){h=2;let e=d(g+$,p);return N(),e}}},e}({});
