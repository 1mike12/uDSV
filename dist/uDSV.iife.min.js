/*! https://github.com/leeoniya/uDSV (v0.1.0) */
var uDSV=function(e){"use strict";const t='"',l=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,n=["\t","|",";",","];function r(e,l,n,r=5e3,s=null,i=null){let o=l.cols.delim,f=l.rows.delim,u=i||l.cols.names.length,a=null!=s,c=null!=i&&a,d=f.length,h=0;if(null==l.quote){let t=[],l=0,i=-1;for(;(i=e.indexOf(f,l))>-1&&(t.push(e.slice(l,i).split(o)),l=i+d,t.length!==r||(n(t,h++),t=[],!a||h!==s)););return void(t.length>0&&n(t,h++))}let $=f.charCodeAt(0),p=o.charCodeAt(0);const m=c?RegExp(`[^${o}${f}]+`,"my"):null;let g,y=0,A=0,N=e.length-1,w=[],x="",O=Array(u),C=0,b=u-1;for(;N>=A;){if(g=e.charCodeAt(A),0===y)if(34===g)y=2,A+=1,g=e.charCodeAt(A);else if(g===p||g===$){if(O[C]=x,C+=1,A+=1,x="",g===$){if(w.push(O),w.length===r&&(n(w,h++),w=[],a&&h===s))return;O=Array(u),C=0,A+=d-1}g=e.charCodeAt(A)}else y=1;if(2===y)for(;;)if(34===g){if(34!==e.charCodeAt(A+1)){y=0,A+=1;break}x+=t,A+=2,g=e.charCodeAt(A)}else{let l=e.indexOf(t,A);x+=e.slice(A,l),A=l,g=34}else if(1===y)if(g===p||g===$){if(O[C]=x,C+=1,A+=1,x="",g===$){if(w.push(O),w.length===r&&(n(w,h++),w=[],a&&h===s))return;O=Array(u),C=0,A+=d-1}y=0}else if(c){m.lastIndex=A;let t=m.exec(e)[0];x+=t,A+=t.length}else{let t;C===b?(t=e.indexOf(f,A),-1===t&&(t=e.length)):t=e.indexOf(o,A),x+=e.slice(A,t),A=t}}O[C]=x,w.push(O),n(w,h++)}return e.parse=r,e.schema=function(e,s=10,i=!1){const o=e.match(/(.*)(\r?\n?)/),f=o[1],u=o[2],a=n.find((e=>f.indexOf(e)>-1)),c={quote:e.indexOf(t)>-1?t:null,cols:{delim:a,names:[],types:[]},rows:{delim:u},toTyped:null},d=f.split(a).length,h=[];r(e,c,(e=>h.push(...e)),s,1,d);const $=Object.values(h.shift());return c.cols.names=$,c.cols.types=Array($.length).fill("s"),h.forEach((e=>{e.forEach(((e,t)=>{Number.isNaN(+e)||(c.cols.types[t]="n")}))})),c.toTyped=function(e,t,n=!1){let r=n?"{":"";return e.forEach(((e,s)=>{r+=n?`"${e}":`:"";let i=`r[${s}]`,o=i,f=t.find((e=>null!=e[s]&""!==e[s]));if(null!=f){let e=f[s];if(l.test(e))o=`new Date(${i})`;else if(Number.isNaN(Number.parseFloat(e))){if(/^(?:true|false)$/i.test(e))o=i+".toLowerCase() === 'true' ? true : false";else if("["===e[0]||"{"===e[0])try{JSON.parse(e),o=`JSON.parse(${i})`}catch{}}else o=`Number.parseFloat(${i})`}let u=`${i} === '' || ${i} == null ? undefined : ${i} === 'null' ? null : `;r+=n?`${u} ${o},`:`${i} = ${u} ${o};`})),r+=n?"}":"",Function("rows",`\n\t\tlet arr = ${n?"Array(rows.length)":"rows"};\n\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tlet r = rows[i];   // trim()?\n\t\t\t${n?"arr[i] = "+r:r}\n\t\t}\n\n\t\treturn arr;\n\t`)}($,h,i),c},e}({});
